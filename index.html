<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D Character Sheet</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'Times New Roman', serif; 
            background: #1a0f0b; 
            color: #e0d0c0; 
            padding: 20px; 
            min-height: 100vh; 
        }
        .container { 
            max-width: 900px; 
            margin: 0 auto; 
            background: #2c1810; 
            border: 3px solid #8b4513; 
            border-radius: 8px; 
            overflow: hidden; 
        }

        .tabs { 
            display: flex; 
            background: linear-gradient(to bottom, #5a3928, #3d2418); 
            border-bottom: 2px solid #8b4513; 
        }
        .tab-btn { 
            flex: 1; 
            padding: 15px; 
            border: none; 
            background: transparent; 
            color: #e0d0c0; 
            font-size: 16px; 
            cursor: pointer; 
            transition: all 0.3s; 
            border-right: 1px solid #8b4513;
            font-family: 'Times New Roman', serif;
        }
        .tab-btn:last-child { border-right: none; }
        .tab-btn.active { 
            background: #8b4513; 
            text-shadow: 0 0 5px #ffd700;
        }
        .tab-content { display: none; padding: 20px; }
        .tab-content.active { display: block; }
        
        .header { 
            background: linear-gradient(to bottom, #3d2418, #2c1810); 
            color: #e0d0c0; 
            padding: 25px; 
            text-align: center; 
            border-bottom: 3px solid #8b4513;
        }
        .character-info { 
            display: flex; 
            gap: 15px; 
            margin-bottom: 15px; 
            flex-wrap: wrap; 
            justify-content: center; 
        }
        .input-group { 
            flex: 1; 
            min-width: 200px; 
        }
        .input-group label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: bold; 
            color: #d4af37; 
            font-size: 0.9em;
        }
        .input-group input, .input-group select { 
            width: 100%; 
            padding: 12px; 
            border: 2px solid #8b4513; 
            border-radius: 4px; 
            font-size: 16px; 
            background: #1a0f0b; 
            color: #e0d0c0;
        }
        .input-row { 
            display: flex; 
            gap: 10px; 
            align-items: center; 
        }
        
        .level-system { 
            background: #3d2418; 
            padding: 20px; 
            border-bottom: 2px solid #8b4513; 
        }
        .level-display { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 15px; 
        }
        .level-info { 
            font-size: 1.3em; 
            font-weight: bold; 
            color: #d4af37; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        .exp-display { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        .exp-input { 
            width: 120px; 
            padding: 10px; 
            border: 2px solid #8b4513; 
            border-radius: 4px; 
            font-size: 16px; 
            text-align: center; 
            background: #1a0f0b;
            color: #e0d0c0;
        }
        
        .stats-panel { 
            padding: 20px; 
            background: #2c1810; 
            border-bottom: 2px solid #5a3928; 
        }
        .stat-row { 
            display: flex; 
            align-items: center; 
            padding: 12px 0; 
            gap: 15px; 
            border-bottom: 1px solid #3d2418;
        }
        .stat-row:last-child { border-bottom: none; }
        .stat-label { 
            flex: 1; 
            font-weight: bold; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            color: #d4af37;
        }
        .stat-input { 
            width: 100px; 
            padding: 10px; 
            border: 2px solid #8b4513; 
            border-radius: 4px; 
            text-align: center; 
            font-size: 16px; 
            background: #1a0f0b;
            color: #e0d0c0;
        }
        
        .points-panel { 
            padding: 20px; 
            background: #3d2418; 
            border-bottom: 2px solid #8b4513; 
        }
        .points-display { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 15px; 
        }
        
        .skills-section { 
            padding: 25px; 
            border-bottom: 2px solid #5a3928; 
        }
        .section-title { 
            font-size: 1.5em; 
            color: #d4af37; 
            margin-bottom: 20px; 
            padding-bottom: 12px; 
            border-bottom: 2px solid #8b4513; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        .skill-row { 
            display: flex; 
            align-items: center; 
            padding: 15px 0; 
            border-bottom: 1px solid #3d2418;
        }
        .skill-row:last-child { border-bottom: none; }
        .skill-name { 
            flex: 2; 
            font-weight: 500; 
            display: flex; 
            align-items: center; 
            gap: 12px; 
        }
        .skill-controls { 
            flex: 1; 
            display: flex; 
            align-items: center; 
            justify-content: flex-end; 
            gap: 12px; 
        }
        .skill-value { 
            font-size: 1.3em; 
            font-weight: bold; 
            color: #d4af37; 
            min-width: 40px; 
            text-align: center; 
        }
        
        .btn { 
            padding: 10px 16px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 14px; 
            font-weight: bold; 
            transition: all 0.3s; 
        }
        .btn-plus { background: #27ae60; color: white; }
        .btn-minus { background: #c44536; color: white; }
        .btn-roll { background: #8b4513; color: white; }
        .btn-dice { background: #3498db; color: white; margin: 5px; }
        .btn-small { padding: 6px 12px; font-size: 12px; }
        .btn:disabled { 
            background: #5a3928; 
            color: #8b7d6b; 
            cursor: not-allowed; 
        }

        .popup { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(26, 15, 11, 0.95); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            z-index: 1000; 
        }
        .popup-content { 
            background: #2c1810; 
            padding: 35px; 
            border-radius: 8px; 
            max-width: 90%; 
            width: 500px; 
            max-height: 80vh; 
            overflow-y: auto; 
            border: 3px solid #8b4513;
        }
        .spells-content { width: 800px; text-align: left; }

        .dice-rolls { 
            display: flex; 
            justify-content: center; 
            gap: 20px; 
            margin: 20px 0; 
        }
        .dice { 
            width: 60px; 
            height: 60px; 
            background: #8b4513; 
            border-radius: 8px; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            font-size: 1.8em; 
            font-weight: bold; 
            color: #1a0f0b; 
        }
        
        .success { color: #27ae60; font-weight: bold; font-size: 1.3em; }
        .failure { color: #e74c3c; font-weight: bold; font-size: 1.3em; }
        
        .skill-disabled {
            opacity: 0.4;
            color: #8b7d6b !important;
        }
        .skill-disabled .skill-value {
            color: #8b7d6b !important;
        }

        .spell-icon {
            cursor: pointer;
            margin-left: 10px;
            font-size: 1.2em;
        }

        .spell-item {
            background: #3d2418;
            margin: 10px 0;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }
        .spell-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .spell-name {
            font-weight: bold;
            color: #d4af37;
            font-size: 1.2em;
        }
        .spell-order {
            background: #8b4513;
            color: #e0d0c0;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
        }
        .spell-details {
            color: #b8a28a;
            font-size: 0.95em;
            line-height: 1.4;
        }
        .spell-learned {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }

        .dice-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
            align-items: center;
        }

        .dice-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
        }

        .dice-count {
            width: 80px;
            padding: 10px;
            border: 2px solid #8b4513;
            border-radius: 4px;
            background: #1a0f0b;
            color: #e0d0c0;
            text-align: center;
        }

        .custom-dice-input {
            width: 80px;
            padding: 10px;
            border: 2px solid #8b4513;
            border-radius: 4px;
            background: #1a0f0b;
            color: #e0d0c0;
            text-align: center;
        }

        .notes-container {
            margin: 20px 0;
        }
        .note-item {
            background: #3d2418;
            margin: 10px 0;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #27ae60;
        }
        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .note-title {
            font-weight: bold;
            color: #d4af37;
            font-size: 1.2em;
        }
        .note-preview {
            color: #b8a28a;
            font-size: 0.95em;
            line-height: 1.4;
        }
        .note-actions {
            display: flex;
            gap: 10px;
        }

        .search-box {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #8b4513;
            border-radius: 4px;
            background: #1a0f0b;
            color: #e0d0c0;
        }

        .export-import {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
        }

        @media (max-width: 768px) {
            .character-info, .stat-row, .skill-row { flex-direction: column; gap: 12px; }
            .skill-controls { width: 100%; justify-content: space-between; }
            .exp-display, .level-display { flex-direction: column; gap: 15px; }
            .points-display { flex-direction: column; }
            .tabs { flex-direction: column; }
            .dice-container { flex-direction: column; }
            .export-import { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="tabs">
            <button class="tab-btn active" onclick="openTab('character')">üßô –ü–µ—Ä—Å–æ–Ω–∞–∂</button>
            <button class="tab-btn" onclick="openTab('inventory')">üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
            <button class="tab-btn" onclick="openTab('dice')">üé≤ –ö—É–±–∏–∫–∏</button>
            <button class="tab-btn" onclick="openTab('notes')">‚úçÔ∏è –ó–∞–º–µ—Ç–∫–∏</button>
        </div>

        <div id="character-tab" class="tab-content active">
            <div class="header">
                <h1 style="font-size: 2.5em; color: #d4af37; margin-bottom: 20px;">‚öîÔ∏è D&D Character Sheet</h1>
                
                <div class="export-import">
                    <button class="btn btn-roll" onclick="exportCharacter()">üì§ –≠–∫—Å–ø–æ—Ä—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</button>
                    <button class="btn btn-roll" onclick="importCharacter()">üì• –ò–º–ø–æ—Ä—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</button>
                </div>
                
                <div class="character-info">
                    <div class="input-group">
                        <label for="characterName">–ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:</label>
                        <input type="text" id="characterName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
                    </div>
                    <div class="input-group">
                        <label for="characterSurname">–§–∞–º–∏–ª–∏—è:</label>
                        <input type="text" id="characterSurname" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é">
                    </div>
                    <div class="input-group">
                        <label for="characterTitle">–¢–∏—Ç—É–ª:</label>
                        <input type="text" id="characterTitle" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–∏—Ç—É–ª">
                    </div>
                </div>

                <div class="character-info">
                    <div class="input-group">
                        <label for="characterRace">–†–∞—Å–∞:</label>
                        <select id="characterRace" onchange="onRaceChange()">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å—É</option>
                            <option value="atski">üî• –ê—Ü–∫–∏ (–ü–µ—Ä—Å—ã)</option>
                            <option value="knofi">üó£Ô∏è –ö–Ω–æ—Ñ—ã (–†–∏–º–ª—è–Ω–µ)</option>
                            <option value="vorki">‚ùÑÔ∏è –í–æ—Ä–∫–∏ (–í–∏–∫–∏–Ω–≥–∏)</option>
                            <option value="minci">üéØ –ú–∏–Ω—Ü—ã (–ê–∑–∏–∞—Ç—ã)</option>
                            <option value="kaei">‚öíÔ∏è –ö–∞—ç–π—Ü—ã (–ù–µ–≥—Ä—ã)</option>
                            <option value="forest_elf">üåø –õ–µ—Å–Ω—ã–µ —ç–ª—å—Ñ—ã</option>
                            <option value="high_elf">‚ú® –í—ã—Å—à–∏–µ —ç–ª—å—Ñ—ã</option>
                            <option value="dark_elf">üåë –¢–µ–º–Ω—ã–µ —ç–ª—å—Ñ—ã</option>
                            <option value="dwarf">‚õ∞Ô∏è –î–≤–∞—Ä—Ñ—ã</option>
                            <option value="gnome">üîÆ –ì–Ω–æ–º—ã</option>
                            <option value="orc">üíÄ –û—Ä–∫–∏</option>
                            <option value="goblin">üëπ –ì–æ–±–ª–∏–Ω—ã</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="characterHeritage">–ù–∞—Å–ª–µ–¥–∏–µ:</label>
                        <input type="text" id="characterHeritage" placeholder="–û—Å–æ–±–æ–µ –Ω–∞—Å–ª–µ–¥–∏–µ">
                    </div>
                </div>

                <div class="character-info">
                    <div class="input-group">
                        <label for="characterHeight">–†–æ—Å—Ç (—Å–º):</label>
                        <div class="input-row">
                            <input type="number" id="characterHeight" readonly>
                            <button class="btn" id="generateHeightBtn" onclick="generateHeightForSelectedRace()" style="background: #8b4513; color: white;">üé≤ –ê–≤—Ç–æ</button>
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="characterWeight">–í–µ—Å (–∫–≥):</label>
                        <input type="number" id="characterWeight" placeholder="–í–µ—Å">
                    </div>
                    <div class="input-group">
                        <label for="characterAge">–í–æ–∑—Ä–∞—Å—Ç (–ª–µ—Ç):</label>
                        <input type="number" id="characterAge" placeholder="–í–æ–∑—Ä–∞—Å—Ç">
                    </div>
                </div>
            </div>

            <div class="level-system">
                <div class="level-display">
                    <div class="level-info">
                        –£—Ä–æ–≤–µ–Ω—å: <span id="currentLevel">0</span>
                        <button class="btn btn-roll" onclick="editLevel()">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å</button>
                        <button class="btn btn-roll" onclick="showLevelsTable()">üìä –¢–∞–±–ª–∏—Ü–∞</button>
                    </div>
                    <div class="exp-display">
                        <input type="number" id="currentExp" class="exp-input" value="0" min="0">
                        <span style="color: #d4af37; font-weight: bold;">/ <span id="requiredExp">1000</span> XP</span>
                        <button class="btn btn-plus" onclick="addExperience()">‚ûï –û–ø—ã—Ç</button>
                        <button class="btn btn-roll" id="convertBtn" onclick="convertExpToPoints()" style="display: none;">üíé –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>
                </div>
            </div>

            <div class="stats-panel">
                <div class="stat-row">
                    <div class="stat-label">‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ:</div>
                    <input type="number" class="stat-input" id="health" value="100">
                    <button class="btn btn-minus" onclick="changeStat('health', -5)">-5</button>
                    <button class="btn btn-plus" onclick="changeStat('health', 5)">+5</button>
                </div>
                <div class="stat-row">
                    <div class="stat-label">üîÆ –ú–∞–Ω–∞:</div>
                    <input type="number" class="stat-input" id="mana" value="100">
                    <button class="btn btn-minus" onclick="changeStat('mana', -5)">-5</button>
                    <button class="btn btn-plus" onclick="changeStat('mana', 5)">+5</button>
                </div>
                <div class="stat-row">
                    <div class="stat-label">‚ö° –í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å:</div>
                    <input type="number" class="stat-input" id="stamina" value="100">
                    <button class="btn btn-minus" onclick="changeStat('stamina', -5)">-5</button>
                    <button class="btn btn-plus" onclick="changeStat('stamina', 5)">+5</button>
                </div>
            </div>

            <div class="points-panel">
                <div class="points-display">
                    <span style="font-size: 1.3em; font-weight: bold; color: #d4af37;">–°–≤–æ–±–æ–¥–Ω—ã–µ –æ—á–∫–∏ –Ω–∞–≤—ã–∫–æ–≤:</span>
                    <input type="number" id="freePoints" class="stat-input" value="0">
                    <button class="btn btn-roll" onclick="editFreePoints()">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å</button>
                </div>
            </div>

            <div id="skillsContainer"></div>
        </div>

        <div id="inventory-tab" class="tab-content">
            <h2 style="color: #d4af37; text-align: center; margin-bottom: 25px;">üéí –ò–ù–í–ï–ù–¢–ê–†–¨</h2>
            <input type="text" class="search-box" id="inventorySearch" placeholder="üîç –ü–æ–∏—Å–∫ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ...">
            <div id="inventoryContainer"></div>
        </div>

        <div id="dice-tab" class="tab-content">
            <h2 style="color: #d4af37; text-align: center; margin-bottom: 25px;">üé≤ –°–ò–°–¢–ï–ú–ê –ë–†–û–°–ö–û–í</h2>
            
            <div class="dice-controls">
                <span style="color: #d4af37;">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—É–±–∏–∫–æ–≤:</span>
                <input type="number" id="diceCount" class="dice-count" value="1" min="1" max="10">
            </div>

            <div class="dice-container">
                <button class="btn btn-dice" onclick="rollDice('coin')">ü™ô –ú–æ–Ω–µ—Ç–∫–∞</button>
                <button class="btn btn-dice" onclick="rollDice(4)">D4</button>
                <button class="btn btn-dice" onclick="rollDice(6)">D6</button>
                <button class="btn btn-dice" onclick="rollDice(8)">D8</button>
                <button class="btn btn-dice" onclick="rollDice(10)">D10</button>
                <button class="btn btn-dice" onclick="rollDice(12)">D12</button>
                <button class="btn btn-dice" onclick="rollDice(20)">D20</button>
                <button class="btn btn-dice" onclick="rollDice(100)">D100</button>
                <div style="display: flex; gap: 5px; align-items: center;">
                    <button class="btn btn-dice" onclick="rollCustomDice()">‚ö´ D0</button>
                    <input type="number" id="customDiceSides" class="custom-dice-input" value="6" min="2" max="1000" placeholder="–ì—Ä–∞–Ω–∏">
                </div>
            </div>

            <div id="diceResults" style="margin-top: 30px; text-align: center;"></div>
            <div id="diceHistory" style="margin-top: 20px;"></div>
        </div>

        <div id="notes-tab" class="tab-content">
            <h2 style="color: #d4af37; text-align: center; margin-bottom: 25px;">‚úçÔ∏è –°–ò–°–¢–ï–ú–ê –ó–ê–ú–ï–¢–û–ö</h2>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <button class="btn btn-plus" onclick="showAddNotePopup()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É</button>
            </div>
            
            <input type="text" class="search-box" id="notesSearch" placeholder="üîç –ü–æ–∏—Å–∫ –≤ –∑–∞–º–µ—Ç–∫–∞—Ö...">
            
            <div class="notes-container" id="notesContainer"></div>
        </div>
    </div>

    <script>
        // ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò –î–ê–ù–ù–´–ï ==========
        
        // –¢–∞–±–ª–∏—Ü–∞ —É—Ä–æ–≤–Ω–µ–π
        const levelTable = {
            0: { expRequired: 1000, hp: 100, mana: 100, stamina: 100, points: 20 },
            1: { expRequired: 3000, hp: 200, mana: 200, stamina: 200, points: 30 },
            2: { expRequired: 5000, hp: 300, mana: 300, stamina: 300, points: 40 },
            3: { expRequired: 8000, hp: 400, mana: 400, stamina: 400, points: 50 },
            4: { expRequired: 12000, hp: 500, mana: 500, stamina: 500, points: 60 },
            5: { expRequired: 16000, hp: 600, mana: 600, stamina: 600, points: 70 },
            6: { expRequired: 20000, hp: 700, mana: 700, stamina: 700, points: 80 },
            7: { expRequired: 25000, hp: 800, mana: 800, stamina: 800, points: 90 },
            8: { expRequired: 30000, hp: 900, mana: 900, stamina: 900, points: 100 },
            9: { expRequired: 100000, hp: 1000, mana: 1000, stamina: 1000, points: 200 }
        };

        // –°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å
        const races = {
            atski: {
                name: "üî• –ê—Ü–∫–∏ (–ü–µ—Ä—Å—ã)",
                description: "50% –∑–∞—â–∏—Ç–∞ –æ—Ç –æ–≥–Ω—è, 100% –Ω–∞ –∞—Ç–∞–∫—É –æ–≥–Ω–µ–º, –ø—É—Å—Ç—ã–Ω—è —ç—Ç–æ –∏—Ö —Å—Ç–∏—Ö–∏—è",
                lifespan: "350 –ª–µ—Ç",
                bonuses: { "–ú–∞–≥–∏—è –æ–≥–Ω—è": 2 },
                limitations: {}
            },
            knofi: {
                name: "üó£Ô∏è –ö–Ω–æ—Ñ—ã (–†–∏–º–ª—è–Ω–µ)", 
                description: "+1 –∫ –∫—Ä–∞—Å–Ω–æ—Ä–µ—á–∏—é, –∑–Ω–∞–Ω–∏–µ 3 —è–∑—ã–∫–æ–≤",
                lifespan: "400 –ª–µ—Ç",
                bonuses: { "–ö—Ä–∞—Å–Ω–æ—Ä–µ—á–∏–µ": 1 },
                limitations: {}
            },
            vorki: {
                name: "‚ùÑÔ∏è –í–æ—Ä–∫–∏ (–í–∏–∫–∏–Ω–≥–∏)",
                description: "50% –∑–∞—â–∏—Ç–∞ –æ—Ç –ª—å–¥—É, +100% –Ω–∞ –∞—Ç–∞–∫—É –ª—å–¥–æ–º",
                lifespan: "250 –ª–µ—Ç",
                bonuses: { "–ú–∞–≥–∏—è –≤–æ–¥—ã": 2 },
                limitations: {}
            },
            minci: {
                name: "üéØ –ú–∏–Ω—Ü—ã (–ê–∑–∏–∞—Ç—ã)",
                description: "+1 –∫ –¥—Ä–µ–≤–∫–æ–≤–æ–º—É, +1 –∫ –ª–æ–≤–∫–æ—Å—Ç–∏, +1 –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç–∏",
                lifespan: "350 –ª–µ—Ç", 
                bonuses: { "–î—Ä–µ–≤–∫–æ–≤–æ–µ": 1, "–õ–æ–≤–∫–æ—Å—Ç—å": 1, "–í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å": 1 },
                limitations: { "–î—Ä–µ–≤–∫–æ–≤–æ–µ": 19 }
            },
            kaei: {
                name: "‚öíÔ∏è –ö–∞—ç–π—Ü—ã (–ù–µ–≥—Ä—ã)",
                description: "–° —Ä–æ–∂–¥–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Å—Ç–∏—Ö–∏—è –º–µ—Ç–∞–ª–ª–∞",
                lifespan: "300 –ª–µ—Ç",
                bonuses: { "–ú–∞–≥–∏—è –º–µ—Ç–∞–ª–ª–∞": 2 },
                limitations: {}
            },
            forest_elf: {
                name: "üåø –õ–µ—Å–Ω—ã–µ —ç–ª—å—Ñ—ã", 
                description: "–° —Ä–æ–∂–¥–µ–Ω–∏—è –æ–±–ª–∞–¥–∞—é—Ç –º–∞–≥–∏–µ–π –ø—Ä–∏—Ä–æ–¥—ã",
                lifespan: "700 –ª–µ—Ç",
                bonuses: { "–ú–∞–≥–∏—è –ø—Ä–∏—Ä–æ–¥—ã": 2 },
                limitations: {}
            },
            high_elf: {
                name: "‚ú® –í—ã—Å—à–∏–µ —ç–ª—å—Ñ—ã",
                description: "–° —Ä–æ–∂–¥–µ–Ω–∏—è –æ–±–ª–∞–¥–∞—é—Ç –¥–≤—É–º—è —Å—Ç–∏—Ö–∏—è–º–∏",
                lifespan: "2000 –ª–µ—Ç", 
                bonuses: { },
                limitations: { "–í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å": 19 }
            },
            dark_elf: {
                name: "üåë –¢–µ–º–Ω—ã–µ —ç–ª—å—Ñ—ã",
                description: "–° —Ä–æ–∂–¥–µ–Ω–∏—è –≤–ª–∞–¥–µ—é—Ç –º–∞–≥–∏–µ–π —Ç—å–º—ã", 
                lifespan: "700 –ª–µ—Ç",
                bonuses: { "–ú–∞–≥–∏—è —Ç—å–º—ã": 2 },
                limitations: {}
            },
            dwarf: {
                name: "‚õ∞Ô∏è –î–≤–∞—Ä—Ñ—ã",
                description: "–ü—Ä–∏—Ä–æ–∂–¥–µ–Ω–Ω—ã–µ –∫—É–∑–Ω–µ—Ü—ã, –≤–æ–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–∞—Å–∞",
                lifespan: "600 –ª–µ—Ç",
                bonuses: { "–ö—É–∑–Ω–µ—á–Ω–æ–µ –¥–µ–ª–æ": 1 },
                limitations: { "–ö—É–∑–Ω–µ—á–Ω–æ–µ –¥–µ–ª–æ": 19, "–õ–æ–≤–∫–æ—Å—Ç—å": 19 }
            },
            gnome: {
                name: "üîÆ –ì–Ω–æ–º—ã", 
                description: "–ò–∑–æ–±—Ä–µ—Ç–∞—Ç–µ–ª—å–Ω—ã–µ –∏ –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–µ",
                lifespan: "800 –ª–µ—Ç",
                bonuses: { "–†–µ–º–µ—Å–ª–æ": 1 },
                limitations: { "–õ–æ–≤–∫–æ—Å—Ç—å": 19, "–í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å": 19, "–†–µ–º–µ—Å–ª–æ": 19 }
            },
            orc: {
                name: "üíÄ –û—Ä–∫–∏",
                description: "–õ—É—á—à–∏–µ –±–æ–π—Ü—ã, –ø—Ä–µ–∑–∏—Ä–∞—é—Ç –º–∞–≥–∏—é",
                lifespan: "400 –ª–µ—Ç", 
                bonuses: { "–¢—è–∂—ë–ª–∞—è –±—Ä–æ–Ω—è": 1, "–î–≤—É—Ä—É—á–Ω–æ–µ –æ—Ä—É–∂–∏–µ": 1 },
                limitations: { "–¢—è–∂—ë–ª–∞—è –±—Ä–æ–Ω—è": 20, "–î–≤—É—Ä—É—á–Ω–æ–µ –æ—Ä—É–∂–∏–µ": 20 }
            },
            goblin: {
                name: "üëπ –ì–æ–±–ª–∏–Ω—ã",
                description: "–•–∏—Ç—Ä—ã–µ –∏ –±—ã—Å—Ç—Ä–æ —É—á–∞—Ç—Å—è, –Ω–µ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞–≥–∏—é",
                lifespan: "25 –ª–µ—Ç", 
                bonuses: {},
                limitations: { 
                    "–ú–∞–≥–∏—è –≤–æ–¥—ã": 0, "–ú–∞–≥–∏—è –∑–µ–º–ª–∏": 0, "–ú–∞–≥–∏—è –≤–æ–∑–¥—É—Ö–∞": 0, "–ú–∞–≥–∏—è –æ–≥–Ω—è": 0, 
                    "–ú–∞–≥–∏—è –∫—Ä–æ–≤–∏": 0, "–ú–∞–≥–∏—è –º–µ—Ç–∞–ª–ª–∞": 0, "–ú–∞–≥–∏—è –ø—Ä–∏—Ä–æ–¥—ã": 0, "–ú–∞–≥–∏—è —Å–≤–µ—Ç–∞": 0, 
                    "–ú–∞–≥–∏—è —Ç—å–º—ã": 0, "–ú–∞–≥–∏—è –∏–Ω—Ñ–µ—Ä–Ω–æ": 0, "–ú–∞–≥–∏—è —Ö–∞–æ—Å–∞": 0, "–ú–∞–≥–∏—è —Ä–∞–∑—É–º–∞": 0, 
                    "–ú–∞–≥–∏—è –ñ–∏–∑–Ω–∏": 0, "–ú–∞–≥–∏—è —Å–º–µ—Ä—Ç–∏": 0, "–ú–∞–≥–∏—è –ø—É—Å—Ç–æ—Ç—ã": 0, "–ú–∞–≥–∏—è –≠–Ω–µ—Ä–≥–∏–∏": 0, 
                    "–ê–ª—Ö–∏–º–∏—è": 0, "–ó–∞—á–∞—Ä–æ–≤–∞–Ω–∏–µ": 0 
                }
            }
        };

        // –î–∏–∞–ø–∞–∑–æ–Ω—ã —Ä–æ—Å—Ç–∞ –¥–ª—è —Ä–∞—Å
        const raceHeightRanges = {
            atski: { min: 140, max: 210 },
            knofi: { min: 135, max: 205 },
            vorki: { min: 150, max: 220 },
            minci: { min: 130, max: 200 },
            kaei: { min: 140, max: 225 },
            forest_elf: { min: 150, max: 210 },
            high_elf: { min: 170, max: 270 },
            dark_elf: { min: 160, max: 230 },
            dwarf: { min: 110, max: 160 },
            gnome: { min: 40, max: 80 },
            orc: { min: 200, max: 350 },
            goblin: { min: 90, max: 150 }
        };

        // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞–≤—ã–∫–æ–≤
        const skillsStructure = {
            "‚öîÔ∏è –ë–û–ï–í–´–ï –ù–ê–í–´–ö–ò": [
                "–¢—è–∂—ë–ª–∞—è –±—Ä–æ–Ω—è", "–õ—ë–≥–∫–∞—è –±—Ä–æ–Ω—è", "–î–≤—É—Ä—É—á–Ω–æ–µ –æ—Ä—É–∂–∏–µ", 
                "–û–¥–Ω–æ—Ä—É—á–Ω–æ–µ –æ—Ä—É–∂–∏–µ", "–°—Ç—Ä–µ–ª—å–±–∞", "–ë–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ", 
                "–î—Ä–µ–≤–∫–æ–≤–æ–µ", "–†—É–∫–æ–ø–∞—à–Ω—ã–π –±–æ–π", "–ú–µ—Ç–∞–Ω–∏–µ"
            ],
            "üé≠ –û–ë–©–ò–ï –ù–ê–í–´–ö–ò": [
                "–°–∫—Ä—ã—Ç–Ω–æ—Å—Ç—å", "–ö—Ä–∞—Å–Ω–æ—Ä–µ—á–∏–µ", "–õ–æ–≤–∫–æ—Å—Ç—å", "–í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å",
                "–í–∑–ª–æ–º", "–í–æ—Å–ø—Ä–∏—è—Ç–∏–µ", "–£–¥–∞—á–∞", "–ö–∞—Ä–º–∞–Ω–Ω—ã–µ –∫—Ä–∞–∂–∏"
            ],
            "‚öóÔ∏è –†–ï–ú–ï–°–õ–ê": [
                "–ê–ª—Ö–∏–º–∏—è", "–ö—É–∑–Ω–µ—á–Ω–æ–µ –¥–µ–ª–æ", "–ó–∞—á–∞—Ä–æ–≤–∞–Ω–∏–µ", "–†–µ–º–µ—Å–ª–æ"
            ],
            "üîÆ –ú–ê–ì–ò–Ø": [
                "–ú–∞–≥–∏—è –≤–æ–¥—ã", "–ú–∞–≥–∏—è –∑–µ–º–ª–∏", "–ú–∞–≥–∏—è –≤–æ–∑–¥—É—Ö–∞", "–ú–∞–≥–∏—è –∫—Ä–æ–≤–∏",
                "–ú–∞–≥–∏—è –æ–≥–Ω—è", "–ú–∞–≥–∏—è –º–µ—Ç–∞–ª–ª–∞", "–ú–∞–≥–∏—è –ø—Ä–∏—Ä–æ–¥—ã", "–ú–∞–≥–∏—è —Å–≤–µ—Ç–∞",
                "–ú–∞–≥–∏—è —Ç—å–º—ã", "–ú–∞–≥–∏—è –∏–Ω—Ñ–µ—Ä–Ω–æ", "–ú–∞–≥–∏—è —Ö–∞–æ—Å–∞", "–ú–∞–≥–∏—è —Ä–∞–∑—É–º–∞",
                "–ú–∞–≥–∏—è –ñ–∏–∑–Ω–∏", "–ú–∞–≥–∏—è —Å–º–µ—Ä—Ç–∏", "–ú–∞–≥–∏—è –ø—É—Å—Ç–æ—Ç—ã", "–ú–∞–≥–∏—è –≠–Ω–µ—Ä–≥–∏–∏"
            ]
        };

        // –ó–∞–∫–ª–∏–Ω–∞–Ω–∏—è –º–∞–≥–∏–∏ –≤–æ–¥—ã (35 –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–π)
        const waterSpells = [
            {
                name: "–†–æ—Å–∞",
                order: 10,
                effect: "–ó–∞–∫–ª–∏–Ω–∞–Ω–∏–µ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç —Ç–µ–ª–æ –∏ –æ–¥–µ–∂–¥—É –º–∞–≥–∞ —Ç–æ–Ω–∫–æ–π –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–π –≤–æ–¥—è–Ω–æ–π –ø–ª—ë–Ω–∫–æ–π, –ø–æ–º–æ–≥–∞—é—â–µ–π –∏–∑–±–µ–∂–∞—Ç—å –∏—Å—Å—É—à–µ–Ω–∏—è –æ—Ä–≥–∞–Ω–∏–∑–º–∞ –≤ –ø—É—Å—Ç—ã–Ω–µ –∏–ª–∏ –æ–∫–µ–∞–Ω–µ. –ò–ª–∏ –∂–µ —Å–æ–∑–¥–∞–µ—Ç –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ –Ω–∞ –∫–∞–∫–æ–π-–ª–∏–±–æ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ - –≤–ª–∞–≥—É –∏–∑ –Ω–∏—á–µ–≥–æ.",
                type: "–ó–∞–∫–ª—è—Ç–∏–µ, –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ–º–æ–µ –Ω–∞ –æ–±–ª–∞—Å—Ç—å, —Ç–æ—á–µ—á–Ω–æ–µ",
                conditions: "2 —Å–µ–∫—É–Ω–¥—ã –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏, 1 –≤–æ–ª—à–µ–±–Ω—ã–π –∂–µ—Å—Ç",
                duration: "–ú–æ–∂–µ—Ç –¥–µ—Ä–∂–∞—Ç—å—Å—è –æ–∫–æ–ª–æ –æ–¥–Ω–æ–≥–æ-–¥–≤—É—Ö —á–∞—Å–æ–≤, —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ä–∞—Å—Å–µ–∏–≤–∞–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω–æ –ø–æ—Å–ª–µ–¥—É—é—â–µ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ",
                cost: "30 –º–∞–Ω–Ω—ã",
                learned: false
            },
            // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è (—Å–æ–∫—Ä–∞—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏)
        ];

        const spellsBySchool = {
            "–ú–∞–≥–∏—è –≤–æ–¥—ã": waterSpells
        };

        // ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
        
        let availableMagicSchools = {};
        const baseMagicSchools = ["–ú–∞–≥–∏—è –≤–æ–¥—ã", "–ú–∞–≥–∏—è –∑–µ–º–ª–∏", "–ú–∞–≥–∏—è –≤–æ–∑–¥—É—Ö–∞", "–ú–∞–≥–∏—è –æ–≥–Ω—è"];
        let notes = [];
        let inventory = {
            weapons: [],
            armor: [],
            potions: [],
            scrolls: [],
            resources: [],
            valuables: [],
            tools: [],
            other: []
        };
        let diceHistory = [];

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        
        document.addEventListener('DOMContentLoaded', function() {
            try {
                loadAllData();
                renderSkills();
                renderInventory();
                renderNotes();
                updateUI();
                updateLevelDisplay();
                
                // –°–ª—É—à–∞—Ç–µ–ª–∏ –ø–æ–∏—Å–∫–∞
                document.getElementById('inventorySearch').addEventListener('input', renderInventory);
                document.getElementById('notesSearch').addEventListener('input', renderNotes);
                
                console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.');
            }
        });

        // ========== –°–ò–°–¢–ï–ú–ê –£–ü–†–ê–í–õ–ï–ù–ò–Ø –î–ê–ù–ù–´–ú–ò ==========
        
        function loadAllData() {
            loadCharacterData();
            loadNotes();
            loadInventory();
            loadSpells();
        }

        function exportCharacter() {
            try {
                const characterData = {
                    character: {
                        name: document.getElementById('characterName').value,
                        surname: document.getElementById('characterSurname').value,
                        title: document.getElementById('characterTitle').value,
                        race: document.getElementById('characterRace').value,
                        heritage: document.getElementById('characterHeritage').value,
                        height: document.getElementById('characterHeight').value,
                        weight: document.getElementById('characterWeight').value,
                        age: document.getElementById('characterAge').value,
                        health: getHealth(),
                        mana: getMana(),
                        stamina: getStamina(),
                        level: getCurrentLevel(),
                        exp: getCurrentExp(),
                        freePoints: getFreePoints()
                    },
                    skills: getAllSkills(),
                    spells: spellsBySchool,
                    notes: notes,
                    inventory: inventory,
                    availableMagicSchools: availableMagicSchools,
                    metadata: {
                        exportDate: new Date().toISOString(),
                        version: '1.0'
                    }
                };
                
                const dataStr = JSON.stringify(characterData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `dnd_character_${characterData.character.name || 'unknown'}.json`;
                link.click();
                
                URL.revokeObjectURL(url);
                alert('–ü–µ—Ä—Å–æ–Ω–∞–∂ —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω!');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞');
            }
        }

        function importCharacter() {
            try {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.onchange = function(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const characterData = JSON.parse(e.target.result);
                            
                            if (!characterData.character || !characterData.skills) {
                                throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞');
                            }
                            
                            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                            restoreCharacterData(characterData);
                            alert('–ü–µ—Ä—Å–æ–Ω–∞–∂ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω!');
                        } catch (error) {
                            console.error('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞:', error);
                            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞');
                        }
                    };
                    reader.readAsText(file);
                };
                
                input.click();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞');
            }
        }

        function restoreCharacterData(data) {
            // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            if (data.character) {
                document.getElementById('characterName').value = data.character.name || '';
                document.getElementById('characterSurname').value = data.character.surname || '';
                document.getElementById('characterTitle').value = data.character.title || '';
                document.getElementById('characterRace').value = data.character.race || '';
                document.getElementById('characterHeritage').value = data.character.heritage || '';
                document.getElementById('characterHeight').value = data.character.height || '';
                document.getElementById('characterWeight').value = data.character.weight || '';
                document.getElementById('characterAge').value = data.character.age || '';
                
                setHealth(data.character.health || 100);
                setMana(data.character.mana || 100);
                setStamina(data.character.stamina || 100);
                setCurrentLevel(data.character.level || 0);
                setCurrentExp(data.character.exp || 0);
                setFreePoints(data.character.freePoints || 0);
            }
            
            // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–≤—ã–∫–æ–≤
            if (data.skills) {
                Object.entries(data.skills).forEach(([skill, value]) => {
                    setSkillValue(skill, value);
                });
            }
            
            // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–π
            if (data.spells) {
                Object.keys(spellsBySchool).forEach(school => {
                    if (data.spells[school]) {
                        spellsBySchool[school] = data.spells[school];
                    }
                });
                saveSpells();
            }
            
            // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–æ–∫ –∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
            if (data.notes) notes = data.notes;
            if (data.inventory) inventory = data.inventory;
            if (data.availableMagicSchools) availableMagicSchools = data.availableMagicSchools;
            
            saveAllData();
            renderSkills();
            renderInventory();
            renderNotes();
            updateUI();
            updateLevelDisplay();
        }

        function getAllSkills() {
            const skills = {};
            Object.values(skillsStructure).flat().forEach(skill => {
                skills[skill] = getSkillValue(skill);
            });
            return skills;
        }

        function saveAllData() {
            saveCharacterData();
            saveNotes();
            saveInventory();
            saveSpells();
        }

        // ========== –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –ù–ê–í–´–ö–û–í ==========
        
        function renderSkills() {
            const container = document.getElementById('skillsContainer');
            if (!container) return;
            
            container.innerHTML = '';

            for (const [groupName, skills] of Object.entries(skillsStructure)) {
                const section = document.createElement('div');
                section.className = 'skills-section';
                
                const title = document.createElement('div');
                title.className = 'section-title';
                title.innerHTML = groupName;
                section.appendChild(title);

                skills.forEach(skill => {
                    const skillRow = createSkillRow(skill, groupName);
                    section.appendChild(skillRow);
                });
                container.appendChild(section);
            }
            updateUI();
        }

        function createSkillRow(skill, groupName) {
            const skillRow = document.createElement('div');
            skillRow.className = 'skill-row';
            
            const spellIcon = groupName === "üîÆ –ú–ê–ì–ò–Ø" ? 
                `<span class="spell-icon" onclick="showSpells('${skill}')" title="–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è">üîÆ</span>` : '';
            
            skillRow.innerHTML = `
                <div class="skill-name">
                    <span>üéØ</span>
                    <span>${skill}</span>
                    ${spellIcon}
                </div>
                <div class="skill-controls">
                    <button class="btn btn-minus" onclick="decreaseSkill('${skill}')" disabled>-</button>
                    <span class="skill-value" id="skill-${skill}">5</span>
                    <button class="btn btn-plus" onclick="increaseSkill('${skill}')">+</button>
                    <button class="btn btn-roll" onclick="rollSkill('${skill}')">–ë—Ä–æ—Å–æ–∫</button>
                </div>
            `;
            return skillRow;
        }

        function increaseSkill(skillName) {
            const freePoints = getFreePoints();
            if (freePoints <= 0) return;
            
            const skillValue = getSkillValue(skillName);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–∞–≥–∏–∏ –¥–ª—è –í–°–ï–• —Ä–∞—Å
            const isMagicSkill = skillsStructure["üîÆ –ú–ê–ì–ò–Ø"].includes(skillName);
            if (isMagicSkill && !availableMagicSchools[skillName] && skillValue <= 5) {
                const masterPermission = confirm(
                    `üîÆ –í—ã –ø—ã—Ç–∞–µ—Ç–µ—Å—å –∏–∑—É—á–∏—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—É—é –º–∞–≥–∏—é!\n\n` +
                    `–ù–∞–≤—ã–∫ "${skillName}" –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –≤–∞—à–µ–π —Ä–∞—Å—ã.\n` +
                    `–í—ã –ø–æ–ª—É—á–∏–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ú–∞—Å—Ç–µ—Ä–∞ –Ω–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫—É —ç—Ç–æ–π –º–∞–≥–∏–∏?\n\n` +
                    `–ù–∞–∂–º–∏—Ç–µ "–û–ö" –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–Ω–∞–≤—ã–∫ —Å—Ç–∞–Ω–µ—Ç 5 —É—Ä–æ–≤–Ω—è) –∏–ª–∏ "–û—Ç–º–µ–Ω–∞" –¥–ª—è –æ—Ç–º–µ–Ω—ã.`
                );
                
                if (masterPermission) {
                    availableMagicSchools[skillName] = true;
                    setSkillValue(skillName, 5);
                    updateMagicSkillsDisplay();
                    updateUI();
                    saveAllData();
                }
                return;
            }
            
            setSkillValue(skillName, skillValue + 1);
            setFreePoints(freePoints - 1);
            updateUI();
            saveAllData();
        }

        function decreaseSkill(skillName) {
            const skillValue = getSkillValue(skillName);
            
            // –ï—Å–ª–∏ –Ω–∞–≤—ã–∫ –¥–æ—Å—Ç–∏–≥ 5 –∏ –º—ã –ø—ã—Ç–∞–µ–º—Å—è –µ–≥–æ —É–º–µ–Ω—å—à–∏—Ç—å
            if (skillValue === 5) {
                const masterPermission = confirm(
                    `‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –ü–æ–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≤—ã–∫–∞ –Ω–∏–∂–µ –±–∞–∑–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è!\n\n` +
                    `–í—ã –ø—ã—Ç–∞–µ—Ç–µ—Å—å –ø–æ–Ω–∏–∑–∏—Ç—å –Ω–∞–≤—ã–∫ "${skillName}" –Ω–∏–∂–µ 5 —É—Ä–æ–≤–Ω—è.\n` +
                    `–≠—Ç–æ –º–æ–∂–µ—Ç —Å–¥–µ–ª–∞—Ç—å –Ω–∞–≤—ã–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º –∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ú–∞—Å—Ç–µ—Ä–∞ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.\n\n` +
                    `–ù–∞–∂–º–∏—Ç–µ "–û–ö" –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–Ω–∞–≤—ã–∫ —Å—Ç–∞–Ω–µ—Ç 4 —É—Ä–æ–≤–Ω—è) –∏–ª–∏ "–û—Ç–º–µ–Ω–∞" –¥–ª—è –æ—Ç–º–µ–Ω—ã.`
                );
                
                if (!masterPermission) return;
            }
            
            // –ï—Å–ª–∏ –Ω–∞–≤—ã–∫ –¥–æ—Å—Ç–∏–≥ 0, –±–ª–æ–∫–∏—Ä—É–µ–º –µ–≥–æ
            if (skillValue === 1) {
                const masterPermission = confirm(
                    `üö´ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ü–û–ù–ò–ñ–ï–ù–ò–ï –ù–ê–í–´–ö–ê!\n\n` +
                    `–ù–∞–≤—ã–∫ "${skillName}" –±—É–¥–µ—Ç –ø–æ–Ω–∏–∂–µ–Ω –¥–æ 0 –∏ —Å—Ç–∞–Ω–µ—Ç –ù–ï–î–û–°–¢–£–ü–ù–´–ú!\n` +
                    `–î–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ú–∞—Å—Ç–µ—Ä–∞.\n\n` +
                    `–ù–∞–∂–º–∏—Ç–µ "–û–ö" –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –Ω–∞–≤—ã–∫–∞.`
                );
                
                if (!masterPermission) return;
                
                setSkillValue(skillName, 0);
                const freePoints = getFreePoints();
                setFreePoints(freePoints + 1);
                updateUI();
                saveAllData();
                return;
            }
            
            if (skillValue > 0) {
                const freePoints = getFreePoints();
                setSkillValue(skillName, skillValue - 1);
                setFreePoints(freePoints + 1);
                updateUI();
                saveAllData();
            }
        }

        function updateUI() {
            const freePoints = getFreePoints();
            
            document.querySelectorAll('.skill-row').forEach(row => {
                const skillName = row.querySelector('.skill-name span:nth-child(2)').textContent;
                const skillValue = getSkillValue(skillName);
                const minusBtn = row.querySelector('.btn-minus');
                const plusBtn = row.querySelector('.btn-plus');
                const skillValueElement = row.querySelector('.skill-value');
                
                skillValueElement.textContent = skillValue;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
                minusBtn.disabled = skillValue <= 0;
                plusBtn.disabled = freePoints <= 0;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞–≤—ã–∫–∞
                const isDisabled = skillValue === 0 || 
                                 (skillsStructure["üîÆ –ú–ê–ì–ò–Ø"].includes(skillName) && 
                                  !availableMagicSchools[skillName] && 
                                  skillValue <= 5);
                
                row.classList.toggle('skill-disabled', isDisabled);
                
                if (isDisabled) {
                    minusBtn.disabled = true;
                    plusBtn.disabled = true;
                }
            });
            
            updateMagicSkillsDisplay();
        }

        // ========== –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –ó–ê–ö–õ–ò–ù–ê–ù–ò–ô ==========
        
        function loadSpells() {
            try {
                const saved = localStorage.getItem('characterSpells');
                if (saved) {
                    const data = JSON.parse(saved);
                    Object.keys(spellsBySchool).forEach(school => {
                        if (data[school]) {
                            spellsBySchool[school] = data[school];
                        }
                    });
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–π:', error);
            }
        }

        function saveSpells() {
            try {
                localStorage.setItem('characterSpells', JSON.stringify(spellsBySchool));
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–π:', error);
            }
        }

        function showSpells(schoolName) {
            if (!availableMagicSchools[schoolName] && getSkillValue(schoolName) <= 5) {
                alert('‚ùå –≠—Ç–∞ —à–∫–æ–ª–∞ –º–∞–≥–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –≤–∞—à–µ–π —Ä–∞—Å—ã!');
                return;
            }
            
            const spells = spellsBySchool[schoolName] || [];
            const popup = document.createElement('div');
            popup.className = 'popup';
            
            let spellsHTML = '';
            if (spells.length > 0) {
                spells.forEach((spell, index) => {
                    spellsHTML += `
                        <div class="spell-item">
                            <div class="spell-header">
                                <span class="spell-name">${spell.name}</span>
                                <span class="spell-order">–ü–æ—Ä—è–¥–æ–∫ ${spell.order}</span>
                            </div>
                            <div class="spell-details">
                                <p><strong>–≠—Ñ—Ñ–µ–∫—Ç:</strong> ${spell.effect}</p>
                                <p><strong>–¢–∏–ø:</strong> ${spell.type}</p>
                                <p><strong>–£—Å–ª–æ–≤–∏—è:</strong> ${spell.conditions}</p>
                                <p><strong>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> ${spell.duration}</p>
                                <p><strong>–ó–∞—Ç—Ä–∞—Ç—ã:</strong> ${spell.cost}</p>
                            </div>
                            <div class="spell-learned">
                                <input type="checkbox" id="spell-${schoolName}-${index}" 
                                       ${spell.learned ? 'checked' : ''} 
                                       onchange="toggleSpellLearned('${schoolName}', ${index})">
                                <label for="spell-${schoolName}-${index}" style="color: #e0d0c0;">–ò–∑—É—á–µ–Ω–æ</label>
                            </div>
                        </div>
                    `;
                });
            } else {
                spellsHTML = '<p style="text-align: center; color: #8b7d6b;">–ó–∞–∫–ª–∏–Ω–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
            }
            
            popup.innerHTML = `
                <div class="popup-content spells-content">
                    <h2 style="color: #d4af37; text-align: center; margin-bottom: 20px;">üîÆ ${schoolName}</h2>
                    <div style="max-height: 60vh; overflow-y: auto;">
                        ${spellsHTML}
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-roll" onclick="this.closest('.popup').remove()">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(popup);
        }

        function toggleSpellLearned(schoolName, spellIndex) {
            try {
                if (spellsBySchool[schoolName] && spellsBySchool[schoolName][spellIndex]) {
                    spellsBySchool[schoolName][spellIndex].learned = 
                        !spellsBySchool[schoolName][spellIndex].learned;
                    saveSpells();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è:', error);
            }
        }

        // ========== –û–°–¢–ê–õ–¨–ù–´–ï –°–ò–°–¢–ï–ú–´ (—Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π) ==========
        
        // [–û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–∞–∫–∏–º –∂–µ, –Ω–æ —Å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞–º–∏ –æ—à–∏–±–æ–∫]
        // –°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å, –∫—É–±–∏–∫–æ–≤, –∑–∞–º–µ—Ç–æ–∫, –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è, —É—Ä–æ–≤–Ω–µ–π –∏ —Ç.–¥.

        // ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
        
        function openTab(tabName) {
            try {
                document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById(tabName + '-tab').classList.add('active');
                event.currentTarget.classList.add('active');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–∫–∏:', error);
            }
        }

        // –ì–µ—Ç—Ç–µ—Ä—ã/—Å–µ—Ç—Ç–µ—Ä—ã —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
        function getFreePoints() { 
            try {
                const element = document.getElementById('freePoints');
                return element ? parseInt(element.value) || 0 : 0; 
            } catch (error) {
                return 0;
            }
        }
        
        function setFreePoints(value) { 
            try {
                const element = document.getElementById('freePoints');
                if (element) element.value = Math.max(0, value); 
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –æ—á–∫–æ–≤:', error);
            }
        }
        
        function getSkillValue(skillName) { 
            try {
                return parseInt(localStorage.getItem(`skill_${skillName}`)) || 5; 
            } catch (error) {
                return 5;
            }
        }
        
        function setSkillValue(skillName, value) { 
            try {
                localStorage.setItem(`skill_${skillName}`, Math.max(0, value)); 
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–≤—ã–∫–∞:', error);
            }
        }

        // [–û—Å—Ç–∞–ª—å–Ω—ã–µ –≥–µ—Ç—Ç–µ—Ä—ã/—Å–µ—Ç—Ç–µ—Ä—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏...]

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        function saveCharacterData() {
            try {
                const data = {
                    characterName: document.getElementById('characterName').value,
                    characterSurname: document.getElementById('characterSurname').value,
                    characterTitle: document.getElementById('characterTitle').value,
                    characterRace: document.getElementById('characterRace').value,
                    characterHeritage: document.getElementById('characterHeritage').value,
                    characterHeight: document.getElementById('characterHeight').value,
                    characterWeight: document.getElementById('characterWeight').value,
                    characterAge: document.getElementById('characterAge').value,
                    health: getHealth(),
                    mana: getMana(),
                    stamina: getStamina(),
                    freePoints: getFreePoints(),
                    availableMagicSchools: availableMagicSchools
                };
                localStorage.setItem('characterData', JSON.stringify(data));
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:', error);
            }
        }

        function loadCharacterData() {
            try {
                const saved = localStorage.getItem('characterData');
                if (saved) {
                    const data = JSON.parse(saved);
                    document.getElementById('characterName').value = data.characterName || '';
                    document.getElementById('characterSurname').value = data.characterSurname || '';
                    document.getElementById('characterTitle').value = data.characterTitle || '';
                    document.getElementById('characterRace').value = data.characterRace || '';
                    document.getElementById('characterHeritage').value = data.characterHeritage || '';
                    document.getElementById('characterHeight').value = data.characterHeight || '';
                    document.getElementById('characterWeight').value = data.characterWeight || '';
                    document.getElementById('characterAge').value = data.characterAge || '';
                    
                    setHealth(data.health || 100);
                    setMana(data.mana || 100);
                    setStamina(data.stamina || 100);
                    setFreePoints(data.freePoints || 0);
                    
                    if (data.availableMagicSchools) {
                        availableMagicSchools = data.availableMagicSchools;
                    }
                    
                    if (data.characterRace) {
                        document.getElementById('generateHeightBtn').disabled = true;
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:', error);
            }
        }

        // [–û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã...]

    </script>
</body>
</html>